FROM auchida/freebsd

RUN mkdir /ctf
WORKDIR /ctf
COPY jemalloc-2.2.5 /jemalloc-2.2.5
COPY libjemalloc.so /ctf/
COPY Ancienthouse /ctf/

RUN apt-get -y update && \
    apt install -y \
    ipython3 \
    vim \
    git \
    python3-dev \
    python3-pip \
    build-essential \
    ruby \
    ruby-dev \
    wget \
    gdb \
    gdb-multiarch

RUN python3 -m pip install -U pip && \
    python3 -m pip install --no-cache-dir \
    ropgadget \
    pwntools \
    z3-solver \
    smmap2 \
    apscheduler \
    ropper \
    unicorn \
    keystone-engine \
    capstone \
    angr \
    pebble \
    r2pipe

RUN gem install one_gadget seccomp-tools

RUN cd ~/ && git clone --depth 1 https://github.com/pwndbg/pwndbg && \
    cd pwndbg && chmod +x setup.sh && ./setup.sh

RUN git clone --depth 1 https://github.com/scwuaptx/Pwngdb.git ~/Pwngdb && \
    cd ~/Pwngdb && cat ~/Pwngdb/.gdbinit  >> ~/.gdbinit && \
    sed -i "s?source ~/peda/peda.py?# source ~/peda/peda.py?g" ~/.gdbinit

ENV LANG C.UTF-8
