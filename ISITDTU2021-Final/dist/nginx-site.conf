server {
    listen 80;
    listen [::]:80;

    location /login {
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_pass http://127.0.0.1:8080/cgi-bin/caas.cgi?login;
    }

    location /curl {
        set $deny 1;

        if (-f /tmp/session/$cookie_sessionid) {
            set $deny "0";
        }

        if ($deny = "1") {
            return 401;
        }

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_pass http://127.0.0.1:8080/cgi-bin/caas.cgi?curl;
    }
}
